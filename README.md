# DatingRent
Проект по созданию рекомендательной системы по поиску жилья на принципе работы Tinder

Цель данного исследования - разработка рекомендательного алгоритма для съёмного жилья на основе content-based алгоритма. В больших городах существует проблема с выбором съёмного жилья. Поскольку пользователю сложно определиться с выбором, так как сортировки по стоимости и удаленности от места желаемого проживания не хватает. Каждая квартира по-своему уникальна, от простейших удобств - ванной или стиральной машины - до стиля внутренней отделки. Поэтому необходимо создать систему, которая на основе уже выбранных квартир и их полных характеристик, будет выдавать пользователю наиболее подходящее ему предложение. 


## Сбор данных
Сбор информации, требующейся рекомендательному алгоритму происходил в 2 этапа:
Копирование ссылок на объявления.
Переход по ссылкам и дальнейшее скачивание информации о квартире.

Благодаря ресурсоемкому устройству сайта Циана, отображаются не все квартиры, а только выборка из различных ценовых категорий, помещающаяся на 54 страницах - по 28 квартир на каждой. Таким образом становится невозможным банальное перемещение по страницам сайта и копирование ссылок. В результате приходится вводить ценовые рамки квартир, чтобы их количество не превысило 1512. Проект вводит в поля “Цена от - до” числа, начиная с 0 - 27000 и идя с интервалом по 1000 руб.: 27001 - 28000 и тд.
Также возникли проблемы с перелистыванием страниц на сайте - у Циана есть всплывающие окна, препятствующие нажатию нужных кнопок.

Функция selenium “move_to_element” -- самая используемая функция перемещения мышки к элементу на экране -- не справлялась с поставленной задачей. С трудом был найден процесс прокрутки экрана, привязанный к определенному объекту на странице. В остальном проблем со скачиванием ссылок на квартиры не возникло. 
Сбор данных отдельных квартир происходил по по другой схеме. Программа переходит по ранее спарсенным ссылкам на объявления о сдачи квартиры на съем и скачивает всю нужную информацию: описание, адрес, имеющиеся теги (стиральная машина и тд.) и, естественно, фотографии самой квартиры.

Также циан использует сложную систему хранения фотографий , вследствие чего невозможен быстрый парсинг объявлений. Вот пример путей по которым хранятся фотографии в памяти агрегатора недвижимости.


Фотографии хранящиеся в разных папках с примерно одинаковыми , но различными путями. В рамках данного проекта не удалось выявить зависимость адреса фото от адреса объявления к которому принадлежат искомые фотографии.
Все данные системы хранятся в базе данных SQL, для комфортного  взаимодействия пользователя с системой. Взаимодействие с базой данных происходит посредством  ORM базы данных sqlalchemy. Каждая операция с базой данных производиться в отдельной сессии в объекте базы данных. Все векторы заранее нормализуются и заносятся в базу данных в виде бинарного файла. Из-за этого база данных на 3000 квартир весит около 200 мб за счет этого возможна быстрая выдача квартиры пользователю при использовании сайта. Был добавлен фильтр по ремонту,  была обработана вся база данных с помощью нейронной сети описанной в статье. И добавлена дополнительная функция поиска по ремонту. При полной базе данных фотографий квартир , появиться возможность увеличить точность предсказаний нейронной сети. 

## Обработка данных 
В проекте, прежде всего, используются данные Циана (самая крупная база объявлений об аренде и продаже недвижимости в Московской области). С помощью библиотеки Selenium программа:
Переходит на главную страницу Циана и парсит ссылки на объявления сдачи квартир в таблицу данных.
Переходит по этим ссылкам и копирует со страниц информацию о соответствующей квартире (описание, предметы быта, цену, фотографии и т.д.). 
	После сбора информации исследование приступает к этапу обработки: библиотека pymystem3 проводит лемматизацию данных -- избавление от ненужных слов, таких как “и”, “к” и др. и приведение остальных составляющих к нормальной форме (светлые - светлый, ней - она). Это делается ради достижения наивысшей точности при оценке квартиры. После завершения процесса лемматизации всей доступной текстовой информации о квартире, библиотеки numpy и nlrt преобразуют получившийся экстракт в векторное представление. На данном этапе список квартир представляет собой пучок векторов в n-мерном пространстве. Вектор пользователя является средним арифметическим всех векторов квартир, положительно оцененных посетителем. Похожесть имеющихся квартир и “идеальной квартирой” Пользователя-- косинус угла между векторами. Все квартиры сортируются по убыванию косинуса, т.е. от лучшей к худшей и наиболее подходящая выводится на экран.


## Алгоритм работы сайта
Алгоритм работы пользователя с сайтом: Если пользователь зарегистрирован , он входит в систему. Если пользователь не зарегистрирована в системе , он регистрируется.  Далее идет меню, где пользователь может выбрать между: просмотром уже оцененных квартир, поиском новой квартиры, и выходом из аккаунта. Для поиска новых квартир пользователю необходимо ввести фильтры для поиска (максимальная цена, станции метро, ремонт). После чего алгоритм предложит оценить квартиру, подобранную по профилю вкуса пользователя. Из меню выбора квартиры пользователь может перейти на страницу объявления в циане и выйти в главное меню.

Сам сайт выполнен на фреймворке Flask это позволило в короткие сроки написать быстроразвертываемый сайт с базой данных и сложной логикой работы, с поддержкой opencv и Python.
![image](https://user-images.githubusercontent.com/26749528/157018687-1a3d3319-d4a4-47cf-983d-f0b5c8ee1aa1.png)

## Алгоритм выдачи рекомендации
1. От пользователя приходят фильтры (максимальная цена, станции метро, ремонт).
2. По фильтрам пользователя отбираются апартаменты , которые пользователь еще не оценил.
3.Если их нет , то пользователю предлагается сменить фильтры или просмотреть список ранее оцененных квартир.
4. Дальше программа собирает список квартир , которые пользователь уже оценил, чтобы на их основе выдал новую квартиру, если пользователь еще ни разу не оценивал, квартир ему предоставляеться случайная, удовлетворяющая фильтрам.
5. Далее создается нормализованный вектор оцененных квартир пользователя. Вектор пользователя сравнивается с каждым вектором квартиры, подходящей по фильтрам. Самый близкий вектор к вектору пользователя возвращается сайту и он предоставляет возможность пользователю оценить новую квартиру.
![image](https://user-images.githubusercontent.com/26749528/157018499-09661bae-97d9-4105-af22-e281f0fec7e9.png)
## Страница оценки
![image](https://user-images.githubusercontent.com/26749528/157019028-7a9c5244-829b-46e5-9b59-cea4b3dad63f.png)
